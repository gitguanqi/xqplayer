(function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t()):"function"==typeof define&&define.cmd?define(function(e,i,s){s.exports=t()}):e.XQVideoPlayer=t()})(this,function(){function e(e){let t={el:"",url:"",poster:"",barrages:[],mode:"m3u8",width:1200,height:600},i={...t,...e};if(!Object.keys(i).length)throw new Error("Options is must!");for(const e in i)if(!i[e])throw new Error(e+" is must!");this.options=i,this.video={play:!1,scale:!1,loading:!0,error:!1,muted:!1,mutedBar:!1,vol:100,isDraw:!1,draw:!0,set:!1,curSpeed:1,speed:!1,replay:!1,status:!1,statusText:"",barrage:!1,barrageContent:"",barrageList:[],about:{name:"XQVideoPlayer",version:"v0.0.1",url:"",type:"",duration:0},speeds:[{id:1,name:"2.0倍",val:2},{id:2,name:"1.5倍",val:1.5},{id:3,name:"1.25倍",val:1.25},{id:4,name:"1.0倍",val:1},{id:5,name:"0.75倍",val:.75}],qualities:[{id:1,name:"标清",val:1}],url:"",poster:"",mode:"mp4",width:0,height:0},this.video.barrageList=this.options.barrages,this.initElem(),this.initVideo(),this.initEvent()}return e.prototype.initElem=function(){let e=this.dom(this.options.el),t=document.createElement("div");t.className="xqvideo",t.innerHTML=`<div class="xqvideo-box" style="width: ${this.options.width+"px"}; height: ${this.options.height+"px"}">\n            <div class="video-info-box">\n                <video tabindex="-1" id="myvideo" preload="auto"></video>\n                <div class="video-loading">\n                    <p>\n                        <span>\n                            <i class="xvicon xvicon-video"></i>\n                        </span>\n                    </p>\n                </div>\n                <div class="video-loading video-error hide">\n                    <p>\n                        <i class="xvicon xvicon-error"></i>\n                        <small>视频加载出错！</small>\n                        <a href="">刷新重试！</a>\n                    </p>\n                </div>\n                <div class="xqvideo-video-status hide">\n                    <i class="xvicon xvicon-info-circle"></i><span id="statusText"></span>\n                </div>\n                <div class="xqvideo-video-info">\n                    <i class="xvicon xvicon-times"></i>\n                    <div class="xqvideo-video-intro">\n                        <p>\n                            <span>Name：</span>\n                            <small>XQPlayer</small>\n                        </p>\n                        <p>\n                            <span>Author：</span>\n                            <small>gitguanqi</small>\n                        </p>\n                        <p>\n                            <span>Date:</span>\n                            <small>2022-10-07</small>\n                        </p>\n                        <p>\n                            <span>Url：</span>\n                            <small>${location.origin+location.pathname}</small>\n                        </p>\n                        <p>\n                            <span>Type：</span>\n                            <small>${this.options.mode}</small>\n                        </p>\n                    </div>\n                </div>\n                <div class="video-info-close hide" title="关闭画中画">\n                    <i class="xvicon xvicon-times"></i>\n                </div>\n                <div class="video-info-barrages">\n                        <ul></ul>\n                    </div>\n                <div class="video-control">\n                    <div id="progressbar" class="video-control-bar">\n                        <span id="progress-dot" style="width: ${this.video.process};"></span>\n                    </div>\n                    <div class="video-control-btn">\n                        <div class="video-control-left">\n                            <button id="play-btn" class="mobile-play show" title="播放">\n                                <i class="xvicon xvicon-play1"></i>\n                            </button>\n                            <button id="pause-btn" class="mobile-play hide" title="暂停">\n                                <i class="xvicon xvicon-pause"></i>\n                            </button>\n                            <span id="startTime">00:00</span><span>/</span><span id="endTime">00:00</span>\n                        </div>\n                        <div class="video-control-right">\n                            <div class="video-control-barrage">\n                                <span id="video-open-barrage" class="switch">弹</span>\n                                <input id="video-barrage-content" type="text" disabled placeholder="随便说点吧~" maxlength="16">\n                                <button id="video-barrage-send" class="send" disabled>发送</button>\n                            </div>\n                            <div class="video-control-alone video-qua mobile-no">\n                                <button class="quality">标清</button>\n                                <div class="video-control-speed qua hide">\n                                    <span class="active">标清</span>\n                                </div>\n                            </div>\n                            <div class="video-control-alone video-speed mobile-no">\n                                <button title="倍速">\n                                    <i class="xvicon xvicon-dashboard"></i>\n                                </button>\n                                <div class="video-control-speed spe hide">\n                                    <span data-id="2">2倍</span>\n                                    <span data-id="1.5">1.5倍</span>\n                                    <span data-id="1.25">1.25倍</span>\n                                    <span data-id="1">1.0倍</span>\n                                    <span data-id="0.75">0.75倍</span>\n                                </div>\n                            </div>\n                            <div class="video-control-alone video-set">\n                                <button title="设置">\n                                    <i class="xvicon xvicon-set"></i>\n                                </button>\n                                <div class="video-control-set hide">\n                                    <p>\n                                        小窗播放：\n                                        <input class="offscreen" id="draw" type="checkbox">\n                                        <label class="switch" for="draw"></label>\n                                    </p>\n                                    <p>\n                                        循环播放：\n                                        <input class="offscreen" id="replay" type="checkbox">\n                                        <label class="switch" for="replay"></label>\n                                    </p>\n                                </div>\n                            </div>\n                            <div class="video-control-alone vol video-vol">\n                                <button title="音量">\n                                    <i class="xvicon xvicon-volume"></i>\n                                    <i class="xvicon xvicon-muted hide"></i>\n                                </button>\n                                <div class="video-control-volum hide">\n                                    <span id="volBar">\n                                        <small id="volDot" style="height: ${this.video.vol}%;"></small>\n                                    </span>\n                                </div>\n                            </div>\n                            <button title="全屏" class="full-btn">\n                                <i class="xvicon xvicon-fullscreen"></i>\n                            </button>\n                            <button title="复原" class="cancel-btn hide">\n                                <i class="xvicon xvicon-fullscreen-exit"></i>\n                            </button>\n                            <button title="视频信息" id="info-btn">\n                                <i class="xvicon xvicon-info-circle"></i>\n                            </button>\n                            <button title="分享" id="share-btn">\n                                <i class="xvicon xvicon-share"></i>\n                            </button>\n                            <a title="举报" href="https://www.12377.cn/" target="_blank">\n                                <i class="xvicon xvicon-error"></i>\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div id="popShare"></div>\n        </div>`,e.appendChild(t)},e.prototype.gid=function(e){return document.getElementById(e)},e.prototype.dom=function(e){return document.querySelector(e)},e.prototype.domAll=function(e){return document.querySelectorAll(e)},e.prototype.loadVideo=function({video:e,type:t,url:i,poster:s}){if(e){if(t&&["mp4","flv","m3u8"].includes(t)){if("mp4"==t&&(e.src=i),"m3u8"==t)if(Hls.isSupported()){var o=new Hls;o.attachMedia(e),o.on(Hls.Events.MEDIA_ATTACHED,function(){o.loadSource(i),o.on(Hls.Events.MANIFEST_PARSED,function(e,t){console.log("manifest loaded, found "+t.levels.length+" quality level")})})}else console.error("tip: m3u8 video play error!");if("flv"==t)if(flvjs.isSupported()){var n=flvjs.createPlayer({type:"flv",url:i});n.attachMediaElement(e),n.load(),n.play()}else console.error("tip: flv video play error!")}else console.error("tip: type error!");s&&e.setAttribute("poster",s)}else console.error("tip: video not null!")},e.prototype.initVideo=function(){let e=this.gid("myvideo"),t=this.dom(".video-loading"),i=this.options.url,s=this.options.poster,o=this.gid("startTime"),n=this.gid("endTime"),d=this.dom(".video-error"),a=this.gid("progress-dot"),l=this.gid("pause-btn"),r=this.gid("play-btn");this.loadVideo({video:e,type:this.options.mode,url:i,poster:s}),e.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()},e.addEventListener("loadstart",function(){t.classList.add("hide")}),e.addEventListener("timeupdate",()=>{let t=0;t=e.currentTime,this.video.process=t/e.duration*100,o.innerText=this.secondToTime(t),n.innerText=this.secondToTime(e.duration),a.style.width=this.video.process+"%"},!1),e.addEventListener("error",function(e){d.classList.remove("hide")}),e.addEventListener("click",()=>{this.playVideo()},!1),e.addEventListener("ended",()=>{this.video.replay?(e.play(),this.video.play=!0):(this.video.play=!1,r.classList.add("show"),l.classList.add("hide"))},!1),this.addDraw(),this.addVol(),this.addProgree(),this.showBarrage()},e.prototype.addDraw=function(){window.onscroll=(()=>{let e=document.documentElement.scrollTop,t=this.dom(".video-info-box"),i=this.dom(".video-info-close");this.video.draw&&(e>800&&(this.video.isDraw=!0,t.classList.add("draw"),i.classList.remove("hide")),e<199&&(this.video.isDraw=!1,t.classList.remove("draw"),i.classList.add("hide")))})},e.prototype.addVol=function(){let e=this.gid("myvideo"),t=this.gid("volBar"),i=this.gid("volDot");t.addEventListener("mousedown",t=>{let s=this.dom(".video-control"),o=t.clientY-s.offsetTop-30,n=t.target.clientHeight,d=o/n;d=d>1?1:d<.1?.01:d;let a=1-d;this.video.vol=100*a,i.style.height=this.video.vol+"%",e.volume=a,this.video.muted=a<=0},!1),t.addEventListener("mouseup",function(){t.onmousemove=null},!1)},e.prototype.addProgree=function(){let e=this.gid("progressbar"),t=this.gid("myvideo"),i=this.gid("startTime"),s=this.gid("progress-dot");e.addEventListener("mousedown",function(e){let o=e.offsetX/e.target.clientWidth,n=100*o,d=o*t.duration;s.style.width=n+"%",i.innerText=parseFloat(d.toFixed(6)),t.currentTime=d},!1),e.addEventListener("mouseup",function(){e.onmousemove=null},!1)},e.prototype.videoMuted=function(){let e=this.gid("myvideo"),t=this.dom(".xvicon-volume"),i=this.dom(".xvicon-muted"),s=this.gid("volDot");this.video.muted=!this.video.muted,this.video.muted?(e.muted=!0,e.volume=0,this.video.vol=0,s.style.height=0,t.classList.add("hide"),i.classList.remove("hide")):(e.muted=!1,e.volume=1,this.video.vol=100,s.style.height="100%",t.classList.remove("hide"),i.classList.add("hide"))},e.prototype.secondToTime=function(e){let t=0,i=0,s=0,o=e%60,n="";if(e<3600)t=o,i=parseInt(e/60),s=0;else{let o=e%3600;o%60<60&&(t=o%60,i=parseInt(o/60)),i=parseInt(o/60),s=parseInt(e/3600)}return t=t>10?parseInt(t):"0"+parseInt(t),i=i>10?i:"0"+i,s=s>10?s:"0"+s,n=s+":"+i+":"+t,n},e.prototype.initEvent=function(){let e=this.gid("info-btn"),t=this.dom(".xvicon-times"),i=this.gid("play-btn"),s=this.gid("pause-btn"),o=this.dom(".video-qua"),n=this.dom(".video-speed"),d=this.domAll(".spe span"),a=this.dom(".video-set"),l=this.dom(".video-vol"),r=this.dom(".xvicon-volume"),c=this.dom(".xvicon-muted"),v=this.gid("draw"),h=this.gid("replay"),p=this.dom(".full-btn"),u=this.dom(".cancel-btn"),m=this.dom(".video-info-close"),g=this.dom(".video-info-box"),f=this.gid("share-btn"),b=this.gid("video-open-barrage"),y=this.dom(".video-info-barrages"),L=this.gid("video-barrage-content"),x=this.gid("video-barrage-send");e.addEventListener("click",()=>{this.toggleInfo(!0)},!1),t.addEventListener("click",()=>{this.toggleInfo(!1)},!1),i.addEventListener("click",()=>{this.playVideo()}),s.addEventListener("click",()=>{this.playVideo()}),o.addEventListener("mouseover",()=>{this.toggleQualBar(!0)}),o.addEventListener("mouseout",()=>{this.toggleQualBar(!1)}),n.addEventListener("mouseover",()=>{this.toggleSpeed(!0)}),n.addEventListener("mouseout",()=>{this.toggleSpeed(!1)});for(let e=0;e<d.length;e++){const t=d[e];t.addEventListener("click",e=>{let t=e.target.dataset.id;this.setSpeed(t)},!1)}this.showSpeedAct(),a.addEventListener("mouseover",()=>{this.toggleSet(!0)}),a.addEventListener("mouseout",()=>{this.toggleSet(!1)}),v.addEventListener("change",e=>{let t=e.target.checked;this.video.draw=t,this.setPlayType("draw",t)}),h.addEventListener("change",e=>{let t=e.target.checked;this.video.replay=t,this.setPlayType("replay",t)}),l.addEventListener("mouseover",()=>{this.toggleVol(!0)}),l.addEventListener("mouseout",()=>{this.toggleVol(!1)}),r.addEventListener("click",()=>{this.videoMuted()}),c.addEventListener("click",()=>{this.videoMuted()}),p.addEventListener("click",()=>{this.fullScreenOpen(),p.classList.add("hide"),u.classList.remove("hide")}),u.addEventListener("click",()=>{this.fullScreenCancel(),p.classList.remove("hide"),u.classList.add("hide")}),m.addEventListener("click",()=>{g.classList.remove("draw"),m.classList.add("hide"),document.documentElement.scrollTop=0}),f.addEventListener("click",()=>{let e=new XqShare({el:"#popShare",type:"pop"});e.show()}),b.addEventListener("click",()=>{this.video.barrage=!this.video.barrage,this.video.barrage?(y.classList.add("show"),b.classList.add("active"),L.removeAttribute("disabled"),x.removeAttribute("disabled"),this.showBarrage()):(y.classList.remove("show"),b.classList.remove("active"),L.setAttribute("disabled"),x.setAttribute("disabled"))},!1),L.addEventListener("keydown",e=>{let t=L.value;if(!t)return this.setStatus("请输入弹幕内容！");this.video.barrageContent=t,"Enter"===e.key&&(this.video.barrageList.push({avatar:"",name:"用户"+parseInt(100*Math.random(0,1e6)),content:this.video.barrageContent,bg:this.randomColor()}),L.value="",this.showBarrage())},!1),x.addEventListener("click",()=>{let e=L.value;if(!e)return this.setStatus("请输入弹幕内容！");this.video.barrageContent=e,this.video.barrageList.push({avatar:"",name:"用户"+parseInt(100*Math.random(0,1e6)),content:this.video.barrageContent,bg:this.randomColor()}),L.value="",this.showBarrage()},!1)},e.prototype.showBarrage=function(){let e=this.video.barrageList,t=[],i="",s=this.dom(".video-info-barrages ul");if(e&&e.length){for(const i of e)t.push({avatar:i.avatar,name:i.name||"用户"+parseInt(100*Math.random(0,1e6)),content:i.content,bg:this.randomColor()});this.video.barrageList=t;for(const e of this.video.barrageList)i+=`\n                    <li>\n                        <img src="${e.avatar}">\n                        <span>${e.name}</span>\n                        <small style="color: ${e.bg};">${e.content}</small>\n                    </li>\n                `;s.innerHTML=i}},e.prototype.randomColor=function(){let e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),i=Math.floor(256*Math.random());e=e<120?120:e,t=t<120?120:t,i=i<120?120:i;let s=`#${e.toString(16)}${t.toString(16)}${i.toString(16)}`;return s},e.prototype.toggleInfo=function(e){let t=this.dom(".xqvideo-video-info");e?t.classList.add("show"):t.classList.remove("show")},e.prototype.playVideo=function(){let e=this.gid("myvideo"),t=this.gid("pause-btn"),i=this.gid("play-btn");this.video.play=!this.video.play;let s="ontouchstart"in document;this.video.play?(e.play(),i.classList.remove("show"),t.classList.remove("hide")):(e.pause(),i.classList.add("show"),t.classList.add("hide")),s&&t.classList.add("hide")},e.prototype.toggleQualBar=function(e){let t=this.dom(".qua");e?t.classList.remove("hide"):t.classList.add("hide")},e.prototype.toggleSpeed=function(e){let t=this.dom(".spe");e?t.classList.remove("hide"):t.classList.add("hide")},e.prototype.toggleSet=function(e){let t=this.dom(".video-control-set");e?t.classList.remove("hide"):t.classList.add("hide")},e.prototype.toggleVol=function(e){let t=this.dom(".video-control-volum");e?t.classList.remove("hide"):t.classList.add("hide")},e.prototype.setSpeed=function(e){let t=document.getElementById("myvideo");this.video.curSpeed=e,t.playbackRate=e,this.showSpeedAct(),this.setStatus(`已切换到${e}倍速！`)},e.prototype.showSpeedAct=function(){let e=this.domAll(".spe span");for(const t of e)t.getAttribute("data-id")==this.video.curSpeed?t.className="active":t.className=""},e.prototype.setStatus=function(e){let t=this.dom(".xqvideo-video-status"),i=this.gid("statusText");this.video.status=!0,t.classList.remove("hide"),i.innerText=e,setTimeout(()=>{this.video.status=!1,t.classList.add("hide"),i.innerText=""},1e3)},e.prototype.setPlayType=function(e,t){let i="draw"==e?"小窗播放":"循环播放",s=t?"已开启":"已关闭";this.video[e]=t,this.setStatus(`${i}${s}`)},e.prototype.fullScreenOpen=function(){let e=this.dom(".video-info-box");this.video.scale=!0,e.classList.add("scale")},e.prototype.fullScreenCancel=function(){let e=this.dom(".video-info-box");this.video.scale=!1,e.classList.remove("scale")},e});